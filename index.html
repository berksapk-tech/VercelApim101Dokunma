<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>BerksShops | v121 Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background-color: #050505; color: #e1e1e1; font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; margin: 0; padding: 0; }
        .glass { background: rgba(26, 26, 26, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 140, 0, 0.1); }
        .vip-card { position: relative; border: 2px solid transparent; background: linear-gradient(#1a1a1a, #1a1a1a) padding-box, linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #0000ff, #8b00ff) border-box; background-size: 200% auto; animation: rainbowBorder 3s linear infinite; }
        @keyframes rainbowBorder { to { background-position: 200% center; } }
        .rainbow-text { background: linear-gradient(to right, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #0000ff, #8b00ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-size: 300% auto; animation: rainbowText 2s linear infinite; font-weight: 900; }
        @keyframes rainbowText { to { background-position: 300% center; } }
        .input-pro { background: #121212; border: 1px solid #222; color: white; padding: 12px; border-radius: 12px; outline: none; width: 100%; font-size: 13px; }
        .btn-main { background: linear-gradient(135deg, #ff8c00, #ff5f00); color: black; padding: 14px; border-radius: 12px; font-weight: 800; cursor: pointer; text-align: center; border: none; width: 100%; display: block; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 15px; }
        .modal-overlay.active { display: flex !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .cat-btn { background: #1a1a1a; border: 1px solid #333; padding: 10px 18px; border-radius: 12px; font-size: 11px; font-weight: 800; color: #777; cursor: pointer; white-space: nowrap; }
        .cat-btn.active { background: #ff8c00; color: black; border-color: #ff8c00; }
    </style>
</head>
<body>

    <nav class="px-6 py-5 flex justify-between items-center glass sticky top-0 z-50">
        <div onclick="location.reload()" class="flex flex-col cursor-pointer">
            <span class="text-2xl font-black text-orange-500 italic uppercase leading-none">BERKS<span class="text-white">SHOPS</span></span>
            <span class="text-[10px] font-bold text-gray-500 mt-1 uppercase">v121 Admin & Gaming</span>
        </div>
        <div id="navRight"></div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 mt-6 pb-32">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
            <a href="https://wa.me/12139004420?text=Selam%20Ben%201%20aylÄ±k%20Bir%20Vip%20Paket%20almak%20istyorum" class="glass p-3 rounded-xl flex justify-between items-center text-[10px] font-bold uppercase">1 AY <b class="text-orange-500">49 â‚º</b></a>
            <a href="https://wa.me/12139004420?text=Selam%20Ben%203%20aylÄ±k%20Bir%20Vip%20Paket%20almak%20istyorum" class="glass p-3 rounded-xl flex justify-between items-center text-[10px] font-bold uppercase">3 AY <b class="text-orange-500">129 â‚º</b></a>
            <a href="https://wa.me/12139004420?text=Selam%20Ben%2012%20aylÄ±k%20Bir%20Vip%20Paket%20almak%20istyorum" class="bg-orange-600/10 border border-orange-500/50 p-3 rounded-xl flex justify-between items-center text-[10px] font-bold uppercase">1 YIL <b class="text-orange-500">449 â‚º</b></a>
            <button onclick="toggleModal('redeemModal', true)" class="border border-dashed border-gray-700 p-3 rounded-xl text-[10px] font-bold text-gray-500 uppercase">Kupon Kullan</button>
        </div>

        <div class="glass p-5 rounded-3xl mb-8 space-y-4">
            <input id="searchQuery" oninput="applyFilters()" type="text" placeholder="Ä°lan ara..." class="input-pro">
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button class="cat-btn active" onclick="setCat('TÃ¼mÃ¼', this)">TÃ¼mÃ¼</button>
                <button class="cat-btn" onclick="setCat('PUBG Mobile', this)">PUBG Mobile</button>
                <button class="cat-btn" onclick="setCat('Roblox', this)">Roblox</button>
                <button class="cat-btn" onclick="setCat('Minecraft', this)">Minecraft</button>
                <button class="cat-btn" onclick="setCat('Steam', this)">Steam</button>
                <button class="cat-btn" onclick="setCat('Nintendo', this)">Nintendo</button>
                <button class="cat-btn" onclick="setCat('Xbox', this)">Xbox</button>
                <button class="cat-btn" onclick="setCat('PlayStation', this)">PlayStation</button>
                <button class="cat-btn" onclick="setCat('Instagram', this)">Instagram</button>
                <button class="cat-btn" onclick="setCat('TikTok', this)">TikTok</button>
                <button class="cat-btn" onclick="setCat('YouTube', this)">YouTube</button>
                <button class="cat-btn" onclick="setCat('Play Store', this)">Play Store</button>
            </div>
        </div>

        <div id="ilanlar" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
    </main>

    <div id="adminModal" class="modal-overlay"><div class="glass p-8 rounded-3xl w-full max-w-xs text-center"><h2 class="text-red-500 font-black mb-6 uppercase">Admin Panel</h2><select id="genMonth" class="input-pro mb-4"><option value="1">1 AY VIP</option><option value="3">3 AY VIP</option><option value="12">12 AY VIP</option></select><button onclick="generateCode()" class="btn-main !bg-white !text-black">KUPON ÃœRET</button><div id="lastCode" class="p-4 bg-black rounded-xl mt-4 font-mono text-orange-500 text-sm">---</div><button onclick="toggleModal('adminModal', false)" class="mt-4 text-xs text-gray-500 font-bold">KAPAT</button></div></div>

    <div id="postModal" class="modal-overlay"><div class="glass p-8 rounded-3xl w-full max-w-md overflow-y-auto max-h-[90vh]"><h2 class="text-2xl font-black mb-6 text-orange-500 uppercase text-center">Ä°lan Ver</h2>
        <div class="space-y-4">
            <input id="pTitle" type="text" placeholder="BaÅŸlÄ±k *" class="input-pro">
            <select id="pGame" class="input-pro">
                <option>PUBG Mobile</option><option>Roblox</option><option>Minecraft</option><option>Steam</option><option>Nintendo</option><option>Xbox</option><option>PlayStation</option><option>Instagram</option><option>TikTok</option><option>YouTube</option><option>Play Store</option>
            </select>
            <input id="pPrice" type="number" placeholder="Fiyat (â‚º) *" class="input-pro">
            <div class="flex gap-2">
                <select id="pPrefix" class="input-pro !w-[100px]"><option value="90">+90</option><option value="7">+7</option><option value="62">+62</option><option value="994">+994</option><option value="44">+44</option></select>
                <input id="pPhone" type="tel" placeholder="WhatsApp *" class="input-pro flex-1">
            </div>
            <textarea id="pDesc" placeholder="AÃ§Ä±klama..." class="input-pro h-24"></textarea>
            <input type="file" id="pFile" class="hidden" onchange="previewFile(this)">
            <label for="pFile" class="w-full bg-gray-800 py-3 rounded-xl text-center block cursor-pointer text-xs font-bold uppercase text-white">FotoÄŸraf Ekle</label>
            <div id="imgPreview" class="flex justify-center"></div>
            <button onclick="publishIlan()" id="pubBtn" class="btn-main">YAYINLA</button>
            <button onclick="toggleModal('postModal', false)" class="w-full text-xs text-gray-500">VAZGEÃ‡</button>
        </div>
    </div></div>

    <div id="authModal" class="modal-overlay"><div class="glass p-8 rounded-3xl w-full max-w-sm text-center"><h2 id="authTitle" class="text-orange-500 font-black mb-6 uppercase">GiriÅŸ</h2><input id="authEmail" type="email" placeholder="E-posta" class="input-pro mb-3"><input id="authPass" type="password" placeholder="Åžifre" class="input-pro mb-6"><button onclick="handleAuth()" class="btn-main mb-4">DEVAM ET</button><button onclick="switchAuth()" id="authSwitch" class="text-xs text-gray-500 uppercase">KAYIT OL</button></div></div>
    <div id="redeemModal" class="modal-overlay"><div class="glass p-8 rounded-3xl w-full max-w-xs text-center"><h2 class="text-orange-500 font-black mb-6 uppercase">Vip Kullan</h2><input id="rCode" type="text" placeholder="KUPON KODU" class="input-pro mb-6 text-center uppercase"><button onclick="claimCode()" class="btn-main">AKTÄ°F ET</button><button onclick="toggleModal('redeemModal', false)" class="mt-4 text-xs text-gray-600">GERÄ°</button></div></div>
    <div id="detailModal" class="modal-overlay"><div class="glass w-full max-w-md rounded-3xl overflow-hidden"><div id="dImg" class="w-full h-64 bg-cover bg-center"></div><div class="p-8"><div id="dVipLabel" class="hidden mb-2"></div><h2 id="dTitle" class="text-2xl font-black text-white uppercase mb-1"></h2><p id="dPrice" class="text-orange-500 font-black mb-4 text-3xl"></p><div id="dDesc" class="bg-black/30 p-4 rounded-xl text-sm text-gray-400 mb-8"></div><a id="dWP" href="#" target="_blank" class="btn-main">SÄ°PARÄ°Åž VER</a><button id="dDel" class="hidden w-full bg-red-600/10 text-red-500 py-3 rounded-xl mt-3 font-bold uppercase">Ä°LAN SÄ°L</button><button onclick="toggleModal('detailModal', false)" class="w-full text-xs mt-4 text-gray-700 font-bold uppercase">KAPAT</button></div></div></div>

    <button style="position:fixed; bottom:30px; right:30px; width:65px; height:65px; background:linear-gradient(135deg, #ff8c00, #ff5f00); border-radius:50%; color:black; z-index:10000;" onclick="openPlus()"><i class="fas fa-plus text-xl"></i></button>
    <button id="adminBtn" class="hidden" style="position:fixed; bottom:30px; left:30px; width:55px; height:55px; background:#1a1a1a; border: 2px solid #ef4444; border-radius:18px; color:#ef4444; z-index:10000;" onclick="toggleModal('adminModal', true)"><i class="fas fa-crown"></i></button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const fbConf = { apiKey: "AIzaSyAmZ2X3yEMKa4rR-EneI-RVWOXmNWD8-6E", authDomain: "berksashare.firebaseapp.com", projectId: "berksashare" };
        const sbUrl = 'https://vkjodymflqhgaowqjoji.supabase.co';
        const sbKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZram9keW1mbHFoZ2Fvd3Fqb2ppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NzYwNjEsImV4cCI6MjA4NzI1MjA2MX0.PqJvklvLka_LIqYJYmIEVGlmaw2Nh_zGt03JeZQGnVI';
        
        const app = initializeApp(fbConf);
        const auth = getAuth(app);
        const supabase = createClient(sbUrl, sbKey);

        const ADMIN_MAIL = "berksplaysation@gmail.com";
        let user = null, vips = [], allIlanlar = [], base64Img = "", isLogin = true, currentCat = "TÃ¼mÃ¼";

        window.toggleModal = (id, open) => {
            const el = document.getElementById(id);
            if(open) el.classList.add('active');
            else el.classList.remove('active');
        };

        window.openPlus = () => { if(!user || !user.emailVerified) toggleModal('authModal', true); else toggleModal('postModal', true); };
        window.switchAuth = () => { isLogin = !isLogin; document.getElementById('authTitle').innerText = isLogin ? "GiriÅŸ" : "KayÄ±t"; document.getElementById('authSwitch').innerText = isLogin ? "KayÄ±t Ol" : "GiriÅŸ Yap"; };
        window.previewFile = (input) => { const r = new FileReader(); r.onload = () => { base64Img = r.result; document.getElementById('imgPreview').innerHTML = `<img src="${base64Img}" class="h-24 rounded-xl mt-4 border border-orange-500">`; }; if(input.files[0]) r.readAsDataURL(input.files[0]); };

        onAuthStateChanged(auth, u => {
            user = u;
            const nav = document.getElementById('navRight');
            const abtn = document.getElementById('adminBtn');
            if(u && u.emailVerified) {
                if(u.email.toLowerCase() === ADMIN_MAIL) abtn.classList.remove('hidden');
                nav.innerHTML = `<button onclick="auth.signOut().then(()=>location.reload())" class="w-10 h-10 bg-orange-500 rounded-xl font-black text-black">${u.email[0].toUpperCase()}</button>`;
            } else {
                nav.innerHTML = `<button onclick="toggleModal('authModal', true)" class="text-xs font-black text-orange-500 uppercase">GÄ°RÄ°Åž</button>`;
            }
            fetchData();
        });

        async function fetchData() {
            const { data: i } = await supabase.from('ilanlar').select('*').order('created_at', { ascending: false });
            const { data: p } = await supabase.from('profiles').select('email, vip_until');
            vips = (p || []).filter(x => x.vip_until && new Date(x.vip_until) > new Date()).map(x => x.email);
            allIlanlar = i || [];
            render(allIlanlar);
        }

        window.setCat = (cat, el) => {
            currentCat = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            applyFilters();
        };

        window.applyFilters = () => {
            const query = document.getElementById('searchQuery').value.toLowerCase();
            const filtered = allIlanlar.filter(i => {
                const matchSearch = i.baslik.toLowerCase().includes(query) || i.user_email.toLowerCase().includes(query);
                const matchCat = (currentCat === "TÃ¼mÃ¼") || (i.oyun === currentCat);
                return matchSearch && matchCat;
            });
            render(filtered);
        };

        function render(list) {
            document.getElementById('ilanlar').innerHTML = list.map(i => {
                const isVip = vips.includes(i.user_email);
                return `
                <div class="${isVip ? 'vip-card' : 'glass'} rounded-2xl overflow-hidden cursor-pointer" onclick='openDetail(${JSON.stringify(i)})'>
                    <img src="${i.resim_urlleri[0]}" class="w-full h-32 object-cover">
                    <div class="p-3">
                        ${isVip ? '<span class="text-[9px] rainbow-text block mb-1 uppercase">VIP ðŸ‘‘</span>' : ''}
                        <h3 class="text-[11px] font-bold truncate text-white uppercase">${i.baslik}</h3>
                        <p class="text-orange-500 font-black text-xs mt-1">${i.fiyat} â‚º</p>
                        <p class="text-[8px] text-gray-500 truncate mt-1 opacity-70">${i.user_email}</p>
                    </div>
                </div>`;
            }).join('');
        }

        window.openDetail = (i) => {
            const isVip = vips.includes(i.user_email);
            document.getElementById('dVipLabel').classList.toggle('hidden', !isVip);
            document.getElementById('dVipLabel').innerHTML = isVip ? '<span class="rainbow-text text-sm">PREMIUM VIP ðŸ‘‘</span>' : '';
            document.getElementById('dTitle').innerText = i.baslik;
            document.getElementById('dPrice').innerText = i.fiyat + " â‚º";
            document.getElementById('dDesc').innerText = i.aciklama;
            document.getElementById('dImg').style.backgroundImage = `url(${i.resim_urlleri[0]})`;
            document.getElementById('dWP').href = `https://wa.me/${i.telefon}`;
            const del = document.getElementById('dDel');
            if(user && (user.email === i.user_email || user.email === ADMIN_MAIL)) {
                del.classList.remove('hidden');
                del.onclick = async () => { if(confirm("Silmek istediÄŸine emin misin?")) { await supabase.from('ilanlar').delete().eq('id', i.id); location.reload(); } };
            } else del.classList.add('hidden');
            toggleModal('detailModal', true);
        };

        window.handleAuth = async () => {
            const e = document.getElementById('authEmail').value, p = document.getElementById('authPass').value;
            try { 
                if(isLogin) await signInWithEmailAndPassword(auth, e, p);
                else { const c = await createUserWithEmailAndPassword(auth, e, p); await sendEmailVerification(c.user); alert("Email doÄŸrulama gÃ¶nderildi!"); }
                location.reload();
            } catch(err) { alert(err.message); }
        };

        window.publishIlan = async () => {
            const t = document.getElementById('pTitle').value, pr = document.getElementById('pPrice').value, ph = document.getElementById('pPhone').value;
            if(!t || !pr || !ph || !base64Img) return alert("BoÅŸ alanlarÄ± doldur!");
            document.getElementById('pubBtn').innerText = "YAYINLANIYOR...";
            const fullPhone = document.getElementById('pPrefix').value + ph.replace(/^0+/, '');
            await supabase.from('ilanlar').insert([{ baslik: t, oyun: document.getElementById('pGame').value, fiyat: Number(pr), telefon: fullPhone, user_email: user.email, resim_urlleri: [base64Img], aciklama: document.getElementById('pDesc').value }]);
            location.reload();
        };

        window.claimCode = async () => {
            const code = document.getElementById('rCode').value.trim().toUpperCase();
            const { data: k } = await supabase.from('kuponlar').select('*').eq('code', code).single();
            if(k) {
                const newEnd = new Date(Date.now() + (k.month * 30 * 24 * 60 * 60 * 1000));
                await supabase.from('profiles').upsert({ email: user.email, vip_until: newEnd.toISOString() });
                await supabase.from('kuponlar').delete().eq('code', code);
                alert("VIP BaÅŸarÄ±yla Aktif Edildi!"); location.reload();
            } else alert("Kupon geÃ§ersiz!");
        };

        window.generateCode = async () => {
            const code = "BERKS-" + Math.random().toString(36).substring(2,7).toUpperCase();
            await supabase.from('kuponlar').insert([{ code, month: parseInt(document.getElementById('genMonth').value) }]);
            document.getElementById('lastCode').innerText = code;
        };
        
        window.auth = auth;
    </script>
</body>
</html>
