<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>BerksShops | v90 Stable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { background-color: #0b0e14; color: #e1e1e1; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        /* VIP RAINBOW & GLOW */
        @keyframes rainbow { 0% { border-color: #ff0000; box-shadow: 0 0 10px #ff000055; } 33% { border-color: #00ff00; box-shadow: 0 0 10px #00ff0055; } 66% { border-color: #0000ff; box-shadow: 0 0 10px #0000ff55; } 100% { border-color: #ff0000; box-shadow: 0 0 10px #ff000055; } }
        .vip-card { border: 2px solid; animation: rainbow 3s linear infinite; position: relative; }
        .vip-card::after { content: 'ðŸ‘‘ VIP'; position: absolute; top: 4px; right: 4px; background: #fbbf24; color: #000; font-size: 8px; font-weight: 900; padding: 1px 4px; border-radius: 4px; z-index: 5; }

        .input-pro { background: #161b22; border: 1px solid #30363d; color: white; padding: 12px; border-radius: 10px; width: 100%; outline: none; }
        .btn-main { background: #6366f1; color: white; padding: 12px; border-radius: 10px; font-weight: 800; cursor: pointer; text-align: center; border: none; width: 100%; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 15px; }
        .hidden { display: none !important; }
        .cat-btn { background: #161b22; border: 1px solid #30363d; padding: 8px 16px; border-radius: 12px; font-size: 11px; font-weight: 800; white-space: nowrap; }
        .cat-btn.active { background: #6366f1; border-color: #6366f1; color: white; }
    </style>
</head>
<body>

    <nav class="px-6 py-4 flex justify-between items-center bg-[#161b22] border-b border-white/5 sticky top-0 z-50">
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()"><span class="text-xl font-black text-indigo-500 italic">BERKS<span class="text-white">SHOPS</span></span></div>
        <div id="navRight" class="flex items-center gap-3">
            <button onclick="window.toggleModal('authModal', true)" class="text-xs font-black bg-white/5 px-4 py-2 rounded-lg">GÄ°RÄ°Åž / KAYIT</button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 mt-6 pb-32">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
            <a href="https://wa.me/12139004420?text=1ay" target="_blank" class="bg-[#161b22] p-4 rounded-xl border border-indigo-500/30 flex justify-between items-center text-[10px] font-bold">1 AY VIP <b class="text-indigo-400">49 â‚º</b></a>
            <a href="https://wa.me/12139004420?text=3ay" target="_blank" class="bg-[#161b22] p-4 rounded-xl border border-purple-500/30 flex justify-between items-center text-[10px] font-bold">3 AY VIP <b class="text-purple-400">129 â‚º</b></a>
            <a href="https://wa.me/12139004420?text=12ay" target="_blank" class="bg-indigo-950/30 p-4 rounded-xl border-2 border-orange-500 flex justify-between items-center text-[10px] font-bold">12 AY VIP <b class="text-orange-500">449 â‚º</b></a>
            <button onclick="window.toggleModal('redeemModal', true)" class="bg-white/5 p-4 rounded-xl border border-dashed border-gray-600 text-[10px] font-bold text-gray-400 uppercase">KUPON</button>
        </div>

        <div class="flex gap-2 overflow-x-auto pb-6 no-scrollbar">
            <button class="cat-btn active" onclick="window.filterCat('TÃ¼mÃ¼', this)">TÃ¼mÃ¼</button>
            <button class="cat-btn" onclick="window.filterCat('Steam', this)">Steam</button>
            <button class="cat-btn" onclick="window.filterCat('PUBG Mobile', this)">PUBG</button>
            <button class="cat-btn" onclick="window.filterCat('Roblox', this)">Roblox</button>
        </div>
        <div id="ilanlar" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
    </main>

    <button style="position:fixed; bottom:30px; right:30px; width:60px; height:60px; background:#6366f1; border-radius:50%; color:white; z-index:1000;" onclick="window.openPlus()"><i class="fas fa-plus"></i></button>
    <button id="adminBtn" class="hidden" style="position:fixed; bottom:30px; left:30px; width:50px; height:50px; background:#ef4444; border-radius:15px; color:white; z-index:1000;" onclick="window.toggleModal('adminModal', true)"><i class="fas fa-crown"></i></button>

    <div id="postModal" class="hidden modal-overlay">
        <div class="bg-[#161b22] p-6 rounded-2xl w-full max-w-md border border-white/10 overflow-y-auto max-h-[90vh]">
            <h2 class="text-xl font-black mb-6 text-center text-indigo-400 italic">Ä°LAN YAYINLA</h2>
            <div class="space-y-4">
                <input id="pTitle" type="text" placeholder="Ä°lan BaÅŸlÄ±ÄŸÄ±" class="input-pro">
                <select id="pGame" class="input-pro"><option>Steam</option><option>PUBG Mobile</option><option>Roblox</option></select>
                <input id="pPrice" type="number" placeholder="Fiyat (â‚º)" class="input-pro">
                
                <div class="flex gap-2">
                    <div class="w-1/3">
                        <select id="pPrefix" class="input-pro text-xs px-1">
                            <option value="90">+90</option>
                            <option value="7">+7</option>
                            <option value="994">+994</option>
                            <option value="1">+1</option>
                            <option value="44">+44</option>
                            <option value="62">+62</option>
                        </select>
                    </div>
                    <div class="w-2/3">
                        <input id="pPhone" type="tel" placeholder="Telefon No" class="input-pro">
                    </div>
                </div>
                
                <textarea id="pDesc" placeholder="AÃ§Ä±klama..." class="input-pro h-24"></textarea>
                <input type="file" id="pFile" class="hidden" onchange="window.previewFile(this)">
                <label for="pFile" class="block bg-white/5 border-2 border-dashed border-gray-700 p-4 text-center rounded-xl cursor-pointer text-xs font-bold">RESÄ°M EKLE</label>
                <div id="imgPreview" class="flex justify-center"></div>
                <button onclick="window.publishIlan()" id="pubBtn" class="btn-main">YAYINLA</button>
                <button onclick="window.toggleModal('postModal', false)" class="w-full text-xs text-gray-500 font-bold uppercase">KAPAT</button>
            </div>
        </div>
    </div>

    <div id="adminModal" class="hidden modal-overlay">
        <div class="bg-[#161b22] p-8 rounded-2xl w-full max-w-xs text-center border border-red-500/30">
            <h2 class="font-black text-red-500 mb-4">ADMIN PANEL</h2>
            <select id="genMonth" class="input-pro mb-4">
                <option value="1">1 AY</option>
                <option value="3">3 AY</option>
                <option value="12">12 AY</option>
            </select>
            <button onclick="window.generateCode()" class="btn-main bg-white text-black mb-4 uppercase">KOD ÃœRET</button>
            <div id="lastCode" class="p-3 bg-black rounded font-mono text-orange-500 text-sm border border-white/5 select-all">---</div>
            <button onclick="window.toggleModal('adminModal', false)" class="mt-4 text-xs opacity-50 font-bold">KAPAT</button>
        </div>
    </div>

    <div id="detailModal" class="hidden modal-overlay">
        <div class="bg-[#161b22] w-full max-w-md rounded-2xl overflow-hidden border border-white/10">
            <div id="dImg" class="w-full h-56 bg-cover bg-center"></div>
            <div class="p-6">
                <h2 id="dTitle" class="text-xl font-black"></h2>
                <p id="dPrice" class="text-indigo-400 font-black mb-4"></p>
                <div id="dDesc" class="bg-black/40 p-3 rounded-lg text-sm text-gray-300 mb-6"></div>
                <a id="dWP" href="#" target="_blank" class="btn-main bg-green-600 block text-center mb-2 uppercase">WhatsApp</a>
                <button id="dDel" class="hidden w-full bg-red-600 text-white py-3 rounded-xl font-black text-xs mt-2 uppercase">Ä°lanÄ± KaldÄ±r</button>
                <button onclick="window.toggleModal('detailModal', false)" class="w-full text-[10px] mt-4 opacity-50 font-bold uppercase">Geri</button>
            </div>
        </div>
    </div>

    <div id="authModal" class="hidden modal-overlay">
        <div class="bg-[#161b22] p-8 rounded-2xl w-full max-w-sm text-center">
            <h2 id="authTitle" class="text-xl font-black mb-6 uppercase">GiriÅŸ</h2>
            <input id="authEmail" type="email" placeholder="E-posta" class="input-pro mb-3">
            <input id="authPass" type="password" placeholder="Åžifre" class="input-pro mb-4">
            <button onclick="window.handleAuth()" class="btn-main mb-3">DEVAM</button>
            <button onclick="window.switchAuth()" id="authSwitch" class="text-xs text-indigo-400 w-full font-bold">KayÄ±t Ol</button>
            <button onclick="window.toggleModal('authModal', false)" class="mt-4 text-[10px] opacity-50 uppercase">Kapat</button>
        </div>
    </div>

    <div id="redeemModal" class="hidden modal-overlay">
        <div class="bg-[#161b22] p-8 rounded-2xl w-full max-w-xs text-center">
            <h2 class="font-black text-indigo-400 mb-4 uppercase">Kupon</h2>
            <input id="rCode" type="text" placeholder="KODU YAZ" class="input-pro text-center mb-4">
            <button onclick="window.claimCode()" class="btn-main">AKTÄ°F ET</button>
            <button onclick="window.toggleModal('redeemModal', false)" class="mt-4 text-xs opacity-50">GERÄ°</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const fbConf = { apiKey: "AIzaSyAmZ2X3yEMKa4rR-EneI-RVWOXmNWD8-6E", authDomain: "berksashare.firebaseapp.com", projectId: "berksashare" };
        const sbUrl = 'https://vkjodymflqhgaowqjoji.supabase.co';
        const sbKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZram9keW1mbHFoZ2Fvd3Fqb2ppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NzYwNjEsImV4cCI6MjA4NzI1MjA2MX0.PqJvklvLka_LIqYJYmIEVGlmaw2Nh_zGt03JeZQGnVI';
        
        const app = initializeApp(fbConf);
        const auth = getAuth(app);
        const supabase = createClient(sbUrl, sbKey);

        const ADMIN = "berksplaysation@gmail.com";
        let user = null, vips = [], allIlanlar = [], base64Img = "", isLogin = true;

        window.toggleModal = (id, open) => document.getElementById(id).classList.toggle('hidden', !open);
        window.switchAuth = () => { isLogin = !isLogin; document.getElementById('authTitle').innerText = isLogin ? "GÄ°RÄ°Åž YAP" : "KAYIT OL"; };
        window.openPlus = () => { if(!user || !user.emailVerified) return alert("OnaylÄ± giriÅŸ yap!"); window.toggleModal('postModal', true); };
        window.previewFile = (input) => { const reader = new FileReader(); reader.onload = () => { base64Img = reader.result; document.getElementById('imgPreview').innerHTML = `<img src="${base64Img}" class="h-20 rounded mt-2 border border-indigo-500/30">`; }; reader.readAsDataURL(input.files[0]); };

        window.handleAuth = async () => {
            const e = document.getElementById('authEmail').value, p = document.getElementById('authPass').value;
            try {
                if(isLogin) {
                    const c = await signInWithEmailAndPassword(auth, e, p);
                    if(!c.user.emailVerified) { alert("Mail onayla!"); await signOut(auth); } else location.reload();
                } else {
                    const c = await createUserWithEmailAndPassword(auth, e, p);
                    await sendEmailVerification(c.user);
                    alert("Onay maili gÃ¶nderildi!"); window.switchAuth();
                }
            } catch(err) { alert(err.message); }
        };

        onAuthStateChanged(auth, async u => {
            user = u;
            if(u && u.emailVerified) {
                if(u.email === ADMIN) document.getElementById('adminBtn').classList.remove('hidden');
                document.getElementById('navRight').innerHTML = `<div onclick="signOut(auth).then(()=>location.reload())" class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black cursor-pointer shadow-lg shadow-indigo-500/30">${u.email[0].toUpperCase()}</div>`;
            }
            fetchData();
        });

        async function fetchData() {
            const { data: i } = await supabase.from('ilanlar').select('*').order('created_at', { ascending: false });
            const { data: p } = await supabase.from('profiles').select('email, vip_until');
            vips = (p || []).filter(x => x.vip_until && new Date(x.vip_until) > new Date()).map(x => x.email);
            allIlanlar = (i || []).sort((a, b) => vips.includes(b.user_email) - vips.includes(a.user_email));
            render(allIlanlar);
        }

        function render(list) {
            document.getElementById('ilanlar').innerHTML = list.map(i => `
                <div class="market-card bg-[#161b22] border border-white/5 rounded-2xl overflow-hidden cursor-pointer ${vips.includes(i.user_email) ? 'vip-card' : ''}" onclick='window.openDetail(${JSON.stringify(i).replace(/'/g, "&apos;")})'>
                    <img src="${i.resim_urlleri[0]}" class="w-full h-32 object-cover">
                    <div class="p-3">
                        <h3 class="text-[11px] font-bold truncate">${i.baslik}</h3>
                        <p class="text-indigo-400 font-black text-xs mt-1">${i.fiyat} â‚º</p>
                    </div>
                </div>`).join('');
        }

        window.openDetail = (i) => {
            document.getElementById('dTitle').innerText = i.baslik;
            document.getElementById('dPrice').innerText = i.fiyat + " â‚º";
            document.getElementById('dDesc').innerText = i.aciklama;
            document.getElementById('dImg').style.backgroundImage = `url(${i.resim_urlleri[0]})`;
            document.getElementById('dWP').href = `https://wa.me/${i.telefon}`;
            const del = document.getElementById('dDel');
            if(user && (user.email === i.user_email || user.email === ADMIN)) {
                del.classList.remove('hidden');
                del.onclick = async () => { if(confirm("Silinsin mi?")) { await supabase.from('ilanlar').delete().eq('id', i.id); location.reload(); } };
            } else del.classList.add('hidden');
            window.toggleModal('detailModal', true);
        };

        window.publishIlan = async () => {
            const btn = document.getElementById('pubBtn'); btn.innerText = "YAYINLANIYOR..."; btn.disabled = true;
            const fullPhone = document.getElementById('pPrefix').value + document.getElementById('pPhone').value.replace(/^0+/, '');
            await supabase.from('ilanlar').insert([{
                baslik: document.getElementById('pTitle').value,
                oyun: document.getElementById('pGame').value,
                fiyat: Number(document.getElementById('pPrice').value),
                telefon: fullPhone,
                user_email: user.email,
                resim_urlleri: [base64Img],
                aciklama: document.getElementById('pDesc').value
            }]);
            location.reload();
        };

        window.generateCode = async () => {
            const code = Math.random().toString(36).substring(2,12).toUpperCase();
            await supabase.from('kuponlar').insert([{ code, month: parseInt(document.getElementById('genMonth').value) }]);
            document.getElementById('lastCode').innerText = code;
        };

        window.claimCode = async () => {
            const code = document.getElementById('rCode').value.trim().toUpperCase();
            const { data: k } = await supabase.from('kuponlar').select('*').eq('code', code).single();
            if(k) {
                const end = new Date(Date.now() + (k.month * 30 * 24 * 60 * 60 * 1000));
                await supabase.from('profiles').upsert({ email: user.email, vip_until: end.toISOString() });
                await supabase.from('kuponlar').delete().eq('code', code);
                alert("VIP AKTÄ°F!"); location.reload();
            } else alert("GeÃ§ersiz Kod!");
        };

        window.filterCat = (cat, el) => {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            render(cat === 'TÃ¼mÃ¼' ? allIlanlar : allIlanlar.filter(x => x.oyun === cat));
        };
    </script>
</body>
</html>
